rules:
  - id: unsafe_unpacking
    languages:
      - ruby
    severity: ERROR
    message: Unsafe TarGz Unpacking 
    patterns:
      - metavariable-regex:
          metavariable: $MODE
          regex: (.*[wa].*)
      - pattern: File.open($ENTRY.full_name , $MODE)
      - pattern-either:
        - pattern-inside: |
            Zlib::GzipReader.open(path) do |$GZ|
            ...
            Gem::Package::TarReader.new($FILE).each do |$ENTRY|
            ...
            end